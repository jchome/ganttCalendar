/*
 * Gantt Calendar by Julien CORON - 2012
 * Copyright 2012 Julien CORON
 * 
 * Licence :
   Ce programme est un logiciel libre ; vous pouvez le redistribuer ou le 
   modifier suivant les termes de la GNU General Public License telle que 
   publiée par la Free Software Foundation ; soit la version 3 de la licence, 
   soit (à votre gré) toute version ultérieure.

   Ce programme est distribué dans l'espoir qu'il sera utile, mais SANS AUCUNE 
   GARANTIE ; pas même la garantie implicite de COMMERCIABILISABILITÉ ni 
   d'ADÉQUATION à UN OBJECTIF PARTICULIER. Consultez la GNU General Public 
   License pour plus de détails.
 * 
 * 
   This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
TimeLineMonth=function(a,e,d,c,b){return this.init(a,e,d,c,b)};$.extend(TimeLineMonth.prototype,{container:"",month:"",year:"",days:{1:[31,31],2:[28,29],3:[31,31],4:[30,30],5:[31,31],6:[30,30],7:[31,31],8:[31,31],9:[30,30],10:[31,31],11:[30,30],12:[31,31]},lang:"fr",months:{fr:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"],en:["January","February","March","April","May","June","July","Agust","September","October","November","December"]},ressourcesColumnHeader:"Ressources",init:function(a,e,d,c,b){this.container=a;this.month=e;this.year=d;this.ressources=c;this.updateMonthCallback=b||function(){};this.drawElements();this.updateMonthCallback();return this},drawElements:function(){var i,p,l,g,f,n,b,m,d,h,c,q,a,o,j,r,k,e;i=$("#"+this.container);i.timeLineMonth=this;p=$(document.createElement("div")).addClass("largeCalendar");i.html(p);l=$(document.createElement("div")).addClass("month");p.html(l);l.html('<div class="prevMonth" title="[Page down] Go to Previous month"></div>		<div class="nameMonth">'+this.months[this.lang][this.month-1]+" "+this.year+'</div>		<div class="nextMonth" id="nextMonth" title="[Page up] Go to next month"></div>');g=$(document.createElement("div")).addClass("leftColumn horizontalCalendarHeaders");p.append(g);f=$(document.createElement("div")).addClass("eventsContainer");p.append(f);n=$(document.createElement("div")).addClass("headerRessources");g.html(n);f.width(p.width()-n.width()-1);b=$(document.createElement("span")).addClass("labelCenter").html(this.ressourcesColumnHeader);n.html(b);m=$(document.createElement("div")).addClass("listRessources");g.append(m);for(d=0;d<this.ressources.groups.length;d++){h=this.ressources.groups[d];m.append('<div id="group_'+h.id+'" class="group">					<span class="labelLeft">'+h.name+"</span>				</div>");for(c=0;c<h.ressources.length;c++){q=h.ressources[c];m.append('<div id="ressource_'+q.id+'" data-group="group_'+h.id+'" class="ressource lineRessource">					<span class="labelRight">'+q.name+"</span>					</div>")}}a=((this.year%4==0&&this.year%100!=0)||this.year%400==0)?(1):(0);o=$(document.createElement("div")).addClass("horizontalCalendarContent for"+this.days[this.month][a]+"days").attr("tabindex","0");f.append(o);j=$(document.createElement("div")).addClass("lineOfDays");o.html(j);r="";for(k=1;k<=this.days[this.month][a];k++){e=(k<10)?("0"+k):(k);r+='<div class="day" id="day_'+e+'">'+e+"</div>"}j.html(r);for(d=0;d<this.ressources.groups.length;d++){h=this.ressources.groups[d];o.append('<div data-group="group_'+h.id+'" class="group">&nbsp;</div>');for(c=0;c<h.ressources.length;c++){q=h.ressources[c];o.append('<div class="lineForRessource" data-ressource="ressource_'+q.id+'" id="events_r_'+q.id+'"></div>')}}this.defineEvents(this)},goToNextMonth:function(){if(this.month==12){this.month=1;this.year++}else{this.month++}this.drawElements();this.updateMonthCallback()},goToPrevMonth:function(){if(this.month==1){this.month=12;this.year--}else{this.month--}this.drawElements();this.updateMonthCallback()},updateWidth:function(){$(".eventsContainer").width($(".largeCalendar").width()-$(".headerRessources").width()-1)},defineEvents:function(a){$(".prevMonth").click(function(){a.goToPrevMonth()});$(".nextMonth").click(function(){a.goToNextMonth()});$(".horizontalCalendarContent").keydown(function(b){switch(b.keyCode){case 34:a.goToPrevMonth();$(".horizontalCalendarContent").focus();break;case 33:a.goToNextMonth();$(".horizontalCalendarContent").focus();break;default:break}});$(window).resize(function(){a.drawElements();a.updateMonthCallback()})}});Event=function(e,b,d,c,a){this.init(e,b,d,c,a)};$.extend(Event.prototype,{ressourceId:"",eventId:"",startDay:"",endDay:"",label:"",jObject:null,init:function(e,b,d,c,a){this.ressourceId=e;this.eventId=b;this.startDay=d;this.endDay=c;this.label=a},drawIn:function(a){var c,b;c=50*(this.startDay-1);b=50*(this.endDay-this.startDay)-3;$("#"+a).find("#events_r_"+this.ressourceId).append('<div id="'+this.eventId+'" class="event" style="left: '+c+"px;width:"+b+'px;">'+this.label+"</div>");this.jObject=$("#"+this.eventId);$("#"+a).find("#"+this.eventId).draggable({axis:"x",containment:"parent",opacity:0.5,snap:true});$("#"+a).find("#events_r_"+this.ressourceId).droppable({drop:function(e,h){var d,g,f;d=$(this).offset().left;g=h.offset.left;f=1+((g-d)/50);$(".debug").html("newDayStart: "+f)}});return this}});
